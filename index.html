<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ¦… è’é‡è¦ªå­å—äºŒåœ˜ ğŸ¦…</title>
  <style>
    /* --- åŸºç¤æ¨£å¼ --- */
    body { font-family: "Segoe UI", sans-serif; background: #f5f5f5; margin: 0; padding: 0; color: #333; }
    h1 { text-align: center; background-color: #ffffff; padding: 1.5em 1em; margin: 0; font-size: 1.8em; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); color: #4a5d23; }
    
    /* å®¹å™¨è¨­å®š */
    .container { 
      display: flex; 
      flex-wrap: wrap; 
      justify-content: center; 
      align-items: flex-start; 
      padding: 2em; 
      max-width: 1280px; 
      margin: auto; 
      gap: 20px; 
    }
    
    /* å·¦å´æ¬„ä½ */
    .left-column { 
      flex: 1; 
      min-width: 400px; 
      display: flex; 
      flex-direction: column; 
      gap: 20px; 
    }

    /* å³å´æ¬„ä½ */
    .right-column { 
      flex: 0 0 320px; 
      display: flex; 
      flex-direction: column; 
      gap: 1.5em; 
    }
    
    .content-box { background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 6px 10px rgba(0, 0, 0, 0.05); }

    /* --- å…¬å‘Šæ¬„ä½æ¨£å¼ --- */
    .news-grid { display: flex; gap: 15px; }
    .news-column { flex: 1; padding: 10px; border-radius: 8px; display: flex; flex-direction: column; }
    
    /* ç¿”é·¹åœ˜å°ˆå±¬æ¨£å¼ (é›è—è‰²ç³») */
    .news-eagle { 
        background: #e8eaf6; /* æ¥µæ·ºçš„è—ç´«è‰² */
        border: 1px solid #c5cae9; /* æ·ºè—é‚Šæ¡† */
    } 

    .news-header {
      font-weight: bold; text-align: center; margin-bottom: 10px; padding-bottom: 5px;
      border-bottom: 2px solid rgba(0,0,0,0.05); font-size: 1.1em; color: #283593;
    }
    
    /* æ²è»¸è¨­å®š */
    .news-scroll-box { max-height: 300px; overflow-y: auto; padding-right: 5px; min-height: 50px; }
    .news-scroll-box::-webkit-scrollbar { width: 6px; }
    .news-scroll-box::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 3px; }
    .news-scroll-box::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }

    .news-item {
      background: #fff; margin-bottom: 8px; padding: 12px; border-radius: 6px;
      cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border: 1px solid rgba(0,0,0,0.05);
    }
    .news-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .news-title { font-size: 1em; font-weight: bold; color: #333; line-height: 1.4; }

    /* --- æ‡¸æµ®è¦–çª— (Modal) --- */
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6); z-index: 2000;
      justify-content: center; align-items: center; padding: 20px;
    }
    .modal-content {
      background: #fff; width: 100%; max-width: 700px; max-height: 90vh;
      border-radius: 12px; overflow-y: auto; position: relative;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .modal-header { padding: 20px; background: #f9f9f9; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 10; }
    .modal-title { font-size: 1.4em; font-weight: bold; color: #283593; margin: 0; }
    .modal-date { color: #666; font-size: 0.9em; margin-top: 5px; }
    .close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2em; cursor: pointer; color: #888; line-height: 0.8; }
    .modal-body { padding: 25px; line-height: 1.6; }

    .section-block { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px dashed #eee; }
    .section-title { font-weight: bold; color: #2c5d47; margin-bottom: 10px; font-size: 1.1em; display:flex; align-items:center; gap:8px;}

    .check-list { list-style: none; padding: 0; margin: 0; }
    .check-list li { position: relative; padding-left: 28px; margin-bottom: 8px; }
    .check-list li::before { content: 'âœ”'; position: absolute; left: 0; top: 0; color: #5ca08e; font-weight: bold; }

    .kid-list-box { background: #eef9f5; border: 2px dashed #5ca08e; border-radius: 12px; padding: 15px; margin-top: 15px; }
    .kid-list li { font-size: 1.15em; color: #333; padding-left: 32px; }
    .kid-list li::before { content: 'ğŸ’'; top: 1px; }

    .adult-list-box { background: #f4f6f8; border: 2px solid #dde1e5; border-radius: 12px; padding: 15px; margin-top: 15px; }
    .adult-list li { font-size: 1em; color: #444; }
    
    .link-text { color: #5ca08e; text-decoration: underline; font-weight: bold; word-break: break-all; }
    .link-text:hover { color: #365119; }

    /* --- RWD --- */
    @media (max-width: 960px) {
      .container { padding: 1em; gap: 1em; }
      .left-column { min-width: 0; }
    }
    @media (max-width: 768px) {
      .container { flex-direction: column; }
      .left-column { width: 100%; }
      .right-column { width: 100%; flex: auto; order: -1; }
      .news-grid { flex-direction: column; }
      .news-scroll-box { max-height: 200px; }
    }
    .home-btn{position:fixed;top:18px;right:18px;background:#4a5d23;color:#fff;padding:8px 14px;border-radius:8px;font-weight:bold;text-decoration:none;box-shadow:0 3px 8px rgba(0,0,0,.15);z-index:1000;}
    
    /* è¡Œäº‹æ›†ç›¸é—œæ¨£å¼ */
    .calendar-title { text-align: center; color: #283593; margin: 0 0 10px 0; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    /* æ–°å¢ï¼šè¡Œäº‹æ›†èªªæ˜æ–‡å­—æ¨£å¼ */
    .calendar-legend { text-align: center; margin-bottom: 15px; font-size: 0.95em; }
    .calendar-frame { width: 100%; height: 600px; border: 0; }

    .form-box { background: #e9f6f0; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #5ca08e; }
    .month { font-size: 1.1em; font-weight: bold; color: #2c5d47; }
    .title { font-size: 0.95em; color: #555; }
    .btn { background-color: #5ca08e; color: white; padding: 8px 14px; border: none; border-radius: 6px; text-decoration: none; font-weight: bold; white-space: nowrap; }
    .action-buttons { display: flex; flex-direction: column; gap: 10px; }
    .query-btn { background: #fdf6e3; padding: 15px; border-radius: 12px; font-size: 1.1em; text-align: center; text-decoration: none; color: #4a5d23; border: 1px solid #ddd; font-weight: bold; }
  </style>
</head>
<body>
  <a href="https://sowtnn02.github.io/home/index" class="home-btn">ğŸ  å›é¦–é </a>
  <h1><a href="index.html" style="text-decoration: none; color: inherit;">è’é‡ä¿è­·å”æœƒè¦ªå­åœ˜å—äºŒåœ˜<br>ğŸ¦… ï¼ˆç¿” é·¹ åœ˜ï¼‰ğŸ¦…</a></h1>
  
  <div class="container">
    
    <div class="left-column">
      <div class="content-box">
        <h3 style="text-align:center; color:#283593; margin-top:0;">ğŸ“¢ åœ˜å‹™ä½ˆå‘Šæ¬„</h3>
        <div class="news-grid">
          
          <div class="news-column news-eagle">
            <div class="news-header"><span style="color:#3f51b5;">â—</span> ç¿”é·¹åœ˜</div>
            <div id="eagle-news-list" class="news-scroll-box">
              <div style="text-align:center; padding:20px; color:#aaa;">è¼‰å…¥ä¸­...</div>
            </div>
          </div>

        </div>
      </div>

      <div class="content-box">
        <h3 class="calendar-title">ğŸ“… åœ˜é›†æœƒè¡Œäº‹æ›†</h3>
        <div class="calendar-legend">
          <span style="color: #3f51b5;">ğŸ¦… â— ç¿”é·¹åœ˜</span>
          <span style="color: #039be5;">â— é·¹åœ˜å·¥ä½œè¡Œç¨‹ ğŸ¦…</span>
        </div>
        <iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=1&ctz=Asia%2FTaipei&showPrint=0&showTz=0&showTitle=0&src=NGU5YThkZjE3MzdjNGQyZTBiNzE2NDNjN2M0MTBkNWE5YmZjOGM2MDE1ZmI3ZWE2ZGQwZTkxYTUzMDA2ODVhOEBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&src=YjRjNjljZjRiZTU2MTgxYjgyMjc5ZWQyMGI2NTJjNTgzNDc4YzE5MGIzZmM3MDkzYjhjNWUxM2Y0YmM1MWUzMEBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&color=%23039be5&color=%233f51b5" class="calendar-frame" frameborder="0" scrolling="no"></iframe>
      </div>
    </div>

    <div class="right-column">
      <div id="form-list"><div style="text-align: center; color: #666; padding: 20px;">è¼‰å…¥è¡¨å–®ä¸­...</div></div>
      <div class="action-buttons">
        <a class="query-btn" href="search1.html">ğŸ” æŸ¥è©¢å‡ºå¸­ç´€éŒ„</a>
        <a class="query-btn" href="searchallteam.html">ğŸ“‹ å°éšŠå‡ºå¸­ç¸½è¦½</a>
      </div>
    </div>
  </div>

  <div id="news-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close-btn" onclick="closeModal()">Ã—</button>
        <h2 class="modal-title" id="m-title">æ¨™é¡Œ</h2>
        <div class="modal-date" id="m-date">æ—¥æœŸ</div>
      </div>
      <div class="modal-body" id="m-body">
        </div>
    </div>
  </div>

  <script>
    // ==========================================
    // 1. å…¬å‘Šç³»çµ±è¨­å®š (ç¶­æŒåŸæ¨£)
    // ==========================================
    const SHEET_ID_NEWS = "1_yffIOhto8dSwRCcmndN1KucMddrcqcuNgGM7yU9gH4";

    // ==========================================
    // 2. è¡¨å–®ç³»çµ±è¨­å®š (æ–°è³‡æ–™åº«)
    // ==========================================
    const FORM_DB_ID = "1rsQZORmQldGeco9YRNUn9jaO10ogvXpsVSqjk4Z8Ur0"; // æ–°è³‡æ–™åº« ID
    const MY_PROXY_URL = "https://script.google.com/macros/s/AKfycbxmzTs-dGe8rlGjeaUJH44bravhTNccqFsfImSz_wV-bSniF-E1aOqZ6nyShvyVYAtFCQ/exec";

    // --- è¼”åŠ©å‡½å¼ ---
    function formatContent(text) {
      if (!text) return "";
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      const linkedText = text.replace(urlRegex, function(url) {
        return `<a href="${url}" target="_blank" class="link-text">${url}</a>`;
      });
      return linkedText.replace(/\n/g, "<br>");
    }

    // ==========================================
    // 3. è¼‰å…¥å…¬å‘Š (News) - ç¶­æŒåŸæ¨£
    // ==========================================
    async function fetchNews(group, containerId, type) {
      const url = `https://opensheet.elk.sh/${SHEET_ID_NEWS}/${group}_News`;
      const container = document.getElementById(containerId);
      
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("API Error");
        let data = await res.json();

        const today = new Date();
        today.setHours(0, 0, 0, 0); 

        data = data.filter(item => {
          const startDate = new Date(item.date);
          startDate.setHours(0, 0, 0, 0);
          if (startDate > today) return false; 
          if (!item.expiryDate) return true;
          const expiry = new Date(item.expiryDate);
          expiry.setHours(0, 0, 0, 0);
          return expiry >= today; 
        });

        data.sort((a, b) => new Date(b.date) - new Date(a.date));

        let html = "";
        if (data.length === 0) {
          html = "<div style='text-align:center; color:#999; font-size:0.9em; padding:20px;'>ç›®å‰ç„¡å…¬å‘Š</div>";
        } else {
          data.forEach(item => {
            item.type = type; 
            html += `
              <div class="news-item" onclick='openModal(${JSON.stringify(item)})'>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
                   <span class="news-date" style="margin-bottom:0;">${item.date}</span>
                   <span style="font-size:0.85em; color:#999;">${item.author ? 'by ' + item.author : ''}</span>
                </div>
                <div class="news-title">${item.title}</div>
              </div>
            `;
          });
        }
        container.innerHTML = html;

      } catch (error) {
        console.error("ç„¡æ³•è¼‰å…¥å…¬å‘Š:", error);
        container.innerHTML = "<div style='text-align:center; color:red; padding:10px;'>è¼‰å…¥å¤±æ•—</div>";
      }
    }

    // è¼‰å…¥ç¿”é·¹å…¬å‘Š
    fetchNews("Eagle", "eagle-news-list", "eagle");

    // ==========================================
    // 4. Modal é‚è¼¯ - ç¶­æŒåŸæ¨£
    // ==========================================
    function openModal(item) {
      document.getElementById("m-title").innerText = item.title;
      const authorText = item.author ? `&nbsp;&nbsp;<span style="font-size:0.9em; color:#5ca08e;">(ç™¼å¸ƒè€…ï¼š${item.author})</span>` : "";
      document.getElementById("m-date").innerHTML = "ç™¼å¸ƒæ—¥æœŸï¼š" + item.date + authorText;
      
      let bodyHtml = "";

      if(item.contentA) {
        bodyHtml += `
          <div class="section-block">
            <div class="section-title">ğŸ“ è¡Œç¨‹èˆ‡å…§å®¹</div>
            <div>${formatContent(item.contentA)}</div>
          </div>`;
      }
      if(item.contentB) {
        bodyHtml += `
          <div class="section-block" style="background:#fffbe6; padding:15px; border-radius:8px;">
            <div class="section-title">ğŸ”¥ ç‰©è³‡èˆ‡äººåŠ›å‹Ÿé›†</div>
            <div>${formatContent(item.contentB)}</div>
          </div>`;
      }
      if(item.noteD || item.listD) {
        bodyHtml += `<div class="adult-list-box">`;
        bodyHtml += `<div class="section-title">ğŸ§‘ å¤§äºº / å°å¼• æ”œå¸¶æ¸…å–®</div>`;
        if(item.noteD) bodyHtml += `<div style="margin-bottom:10px; color:#555; font-weight:500;">${item.noteD}</div>`;
        if(item.listD) {
          const listItems = item.listD.split('\n').map(line => `<li>${line}</li>`).join('');
          bodyHtml += `<ul class="check-list adult-list">${listItems}</ul>`;
        }
        bodyHtml += `</div>`;
      }
      if(item.noteC || item.listC) {
        bodyHtml += `<div class="kid-list-box">`;
        bodyHtml += `<div class="section-title">ğŸ¦… å°é·¹èƒŒåŒ…æª¢æŸ¥</div>`;
        if(item.noteC) bodyHtml += `<div style="margin-bottom:10px; font-weight:bold; color:#d81b60;">${item.noteC}</div>`;
        if(item.listC) {
          const listItems = item.listC.split('\n').map(line => `<li>${line}</li>`).join('');
          bodyHtml += `<ul class="check-list kid-list">${listItems}</ul>`;
        }
        bodyHtml += `</div>`;
      }

      document.getElementById("m-body").innerHTML = bodyHtml;
      document.getElementById("news-modal").style.display = "flex";
    }

    function closeModal() { document.getElementById("news-modal").style.display = "none"; }
    document.getElementById("news-modal").addEventListener("click", function(e) { if(e.target === this) closeModal(); });

    // ==========================================
    // 5. ğŸŸ¢ æ–°ç‰ˆï¼šè¼‰å…¥è¡¨å–® (åªæŠ“å–ã€Œé·¹ã€åˆ†é )
    // ==========================================
    async function loadForms() {
      const container = document.getElementById("form-list");
      container.innerHTML = "<div style='text-align: center; color: #666; padding: 20px;'>è¼‰å…¥è¡¨å–®ä¸­...</div>";

      // è¨­å®šç›®æ¨™ï¼šåªæŠ“ "é·¹" åˆ†é 
      const targetSheetName = "é·¹";
      const url = `${MY_PROXY_URL}?targetId=${FORM_DB_ID}&sheetName=${encodeURIComponent(targetSheetName)}`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        
        if (data.error) throw new Error(data.error);

        // --- æ—¥æœŸéæ¿¾é‚è¼¯ ---
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const validData = data.filter(item => {
          if (!item.title || !item.form_url) return false;

          // A. æª¢æŸ¥ä¸Šæ¶æ—¥æœŸ (Date)
          if (item.date) {
            const startDate = new Date(item.date);
            startDate.setHours(0, 0, 0, 0);
            if (startDate > today) return false; // æ™‚é–“æœªåˆ°
          }
          
          // B. æª¢æŸ¥ä¸‹æ¶æ—¥æœŸ (ExpiryDate)
          if (item.expiryDate) {
            const endDate = new Date(item.expiryDate);
            endDate.setHours(0, 0, 0, 0);
            if (endDate < today) return false; // å·²éæœŸ
          }
          return true;
        });

        container.innerHTML = "";
        if (validData.length === 0) { 
          container.innerHTML = "<div style='text-align:center; padding:20px; color:#888;'>ç›®å‰æ²’æœ‰é–‹æ”¾çš„è¡¨å–®</div>"; 
          return; 
        }

        // æ’åºï¼šä¾æœˆä»½
        validData.sort((a, b) => (a.month || "").localeCompare(b.month || ""));

        validData.forEach(item => {
          const div = document.createElement("div");
          div.className = "form-box";
          // ç¿”é·¹åœ˜å°ˆå±¬é…è‰² (å·¦é‚Šæ¡†è—è‰² #2b6cb0)
          div.style.borderLeft = "5px solid #2b6cb0"; 

          div.innerHTML = `
            <div style="display: flex; flex-direction: column;">
              <div class="month">${item.month}</div>
              <div class="title">${item.title}</div>
            </div>
            <a class="btn" href="${item.form_url}" target="_blank">å¡«å¯«</a>
          `;
          container.appendChild(div);
        });

      } catch (error) { 
        console.error("ç„¡æ³•è¼‰å…¥è¡¨å–®:", error); 
        container.innerHTML = "<div style='text-align:center; color:red;'>ç„¡æ³•è¼‰å…¥è¡¨å–®è³‡æ–™</div>"; 
      }
    }
    
    // åŸ·è¡Œè¼‰å…¥
    loadForms();
  </script>
</body>
</html>
